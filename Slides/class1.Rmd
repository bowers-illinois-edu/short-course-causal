---
title: |
  | Causal Inference for Observational Studies
  | Beyond the Basics
  | Class 1
date: '`r format(Sys.Date(), "%B %d, %Y")`'
author: Jake Bowers
bibliography:
 - ../BIB/references.bib
fontsize: 10pt
geometry: margin=1in
graphics: yes
biblio-style: authoryear-comp
biblatexoptions:
  - natbib=true
output:
  beamer_presentation:
    slide_level: 2
    keep_tex: true
    latex_engine: xelatex
    citation_package: biblatex
    template: icpsr.beamer
    includes:
        in_header:
           - defs-all.sty
    md_extensions: +raw_attribute
---


```{r echo=FALSE, include=FALSE, cache=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).
# knitr settings to control how R chunks work.
rm(list=ls())

require(knitr)

## This plus size="\\scriptsize" from https://stackoverflow.com/questions/26372138/beamer-presentation-rstudio-change-font-size-for-chunk
knitr::knit_hooks$set(mysize = function(before, options, envir) {
			      if (before)
				      return(options$size)
})

knit_hooks$set(plotdefault = function(before, options, envir) {
		       if (before) par(mar = c(3, 3, .1, .1),oma=rep(0,4),mgp=c(1.5,.5,0))
})

opts_chunk$set(
  tidy=TRUE,
  echo=TRUE,
  results='markup',
  strip.white=TRUE,
  fig.path='figs/fig',
  cache=FALSE,
  highlight=TRUE,
  width.cutoff=132,
  size='\\scriptsize',
  out.width='.7\\textwidth',
  fig.retina=FALSE,
  message=FALSE,
  comment=NA,
  mysize=TRUE,
  plotdefault=TRUE)

if(!file.exists('figs')) dir.create('figs')

options(digits=4,
	scipen=8,
	width=132,
	show.signif.stars=FALSE)
```

```{r eval=FALSE, include=FALSE, echo=FALSE}
## Run this only once and then not again until we want a new version from github
library('devtools')
library('withr')
with_libpaths('./lib', install_github("markmfredrickson/RItools"), 'pre')
```

```{r echo=FALSE, warnings=FALSE}
library(dplyr)
library(ggplot2)
library(RItools)
library(optmatch)
library(sandwich)
library(lmtest)
```
# Overview and Review

## Doing Matching, Assessing Designs, Estimating Effects

  1. **Review** Causal inference in randomized experiments; Statistical
     inference for causal effects in randomized experiments \textcite[Chap
     2]{rosenbaum2010}, \cite[Chap 1-3]{gerbergreen2012}.

  1. **How to use optimal, full matching to produce a matched research
     design?**  Multivariate optimal matching review using `optmatch` in R:
     producing matched research designs using matching on scalars, propensity
     scores, and Mahalanobis distances \textcite{hansen2004}, \textcite[Chap
     1,3,7,8,9,13]{rosenbaum2010}, \textcite[Chap 9.0--9.2]{gelman2007dau}.

  2. **How to reason about whether we have a good matched research design?**
     Multivariate balance assessment using null hypothesis testing using the
     `RItools` package for R \textcite{hansenbowers2008} (and perhaps also
     using equivalence testing \textcite{hartman2018equivalence}).

  3. **How to customize and focus the matched research design creation?**
     Multivariate optimal matching; calipers; penalties; combining scores

  4. **How to estimate the ATE  and test hypotheses about causal effects given a
     matched research design?** Estimating ATE and Std Errors from Matched
     Designs using the Block Randomized Experiment as an Analogy.

## Overly Ambitious Plan

  - 09:00--09:30 ---  Introductions: Name, Affiliation/Organization, Interest (Substantive or Methodological)
  - 09:30--10:15 ---  Lecture by Jake to introduce concepts and encourage questions and answers.
  - 10:15--10:45 ---  Exercises by Class to raise even more questions.
  - 10:45 -- 11:00 --- Break
  - 11:00 -- 11:30 --- Lecture by Jake / question and answers about the previous lecture
  - 11:30 -- 12:00 --- Open Discussion on any topic.

## What do you know about causal inference?

These words are used a lot in discussions of causal inference. Why are they important? What do they mean?

  - Potential Outcomes; Counterfactual Outcomes
  - Causal Effect
  - ATE 
  - Randomization
  - Balance
  - Propensity Score
  - Mahalanobis Distance Score
  - Confounding; Selection Bias; Omitted Variable Bias

What other words and/or phrases and/or concepts come to mind when you think about causal inference?

Why is "randomization" listed here?

## Randomized Research Designs As A Standard of Comparison

From last week:
  - *Treatment* $Z_i=1$ for treatment and $Z_i=0$ for control for units $i$
  - Each unit has a pair of *potential outcomes* $(y_{i,Z_i=1},y_{i,Z_i=0})$ (given SUTVA).
  - *Causal Effect*  when $y_{i,Z_i=1} \ne y_{i,Z_i=0}$ 

## Approach 1: Test Hypotheses


  \includegraphics[width=.9\textwidth]{images/cartoonFisher.pdf}


## Approach 2: Estimate Averages


  \includegraphics[width=.9\textwidth]{images/cartoonNeyman.pdf}



## Approach 3: Predict Outcomes

  \includegraphics[width=.9\textwidth]{images/cartoonBayes.pdf}


## Approaches to creating interpretable comparisons:

   - Randomized experiments (more precision from reducing heterogeneity in $Y$)
   - Instrumental variables (with randomized $Z$ created $D$)
   - Natural Experiments / Discontinuities (one $X$ creates $Z$)
   - Difference-in-Differences (reduce bias *and* increase precision from reducing heterogeneity in $Y$)
   - Semi-/Non-parametric Covariance Adjustment (i.e. matching)
   - Parametric covariance adjustment


# Doing Multivariate Matching

## Do we need to match? Assessing balance.


# End Matter

## References

